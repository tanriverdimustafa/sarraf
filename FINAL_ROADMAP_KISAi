# KUYUMCULUK SÄ°STEMÄ° - FINAL ROADMAP
## ğŸ“… Son Revize - Emergent AI Ä°Ã§in HazÄ±r

---

## âš ï¸ Ã–NEMLÄ° NOTLAR

1. âœ… **WebSocket Ã¼st bar ZATEN Ã‡ALIÅIYOR** (dokunma)
2. âœ… **Hurda milyem** = Her iÅŸlemde editlenebilir input (tedarikÃ§i bazlÄ± deÄŸil)
3. âœ… **Stok giriÅŸi transaction YOK** (Sahip kendi cari kartÄ±ndan iÅŸlem yapar)
4. âœ… **Ä°l/Ä°lÃ§e** = Metin input (combo deÄŸil)
5. âŒ **SÃ¼re tahmini YOK** (Emergent AI kendi hÄ±zÄ±nda Ã§alÄ±ÅŸÄ±r)

---

## ğŸ“‹ 16 ANA GÃ–REV

### ğŸ”´ FAZ 1: KRÄ°TÄ°K SORUNLAR (3 GÃ¶rev)

#### GÃ–REV 1.1: Combobox Sorunu
**Sorun:** Hurda, AlÄ±ÅŸ, DÃ¶viz, Party Edit formlarÄ±nda combobox'lar boÅŸ

**Ã‡Ã¶zÃ¼m:**
- Her formda `loadLookups` fonksiyonuna console log ekle
- API response kontrol et
- Value type fix: `<SelectItem value={item.id.toString()}>`
- Test et

**Dosyalar:**
- `frontend/src/components/transactions/forms/HurdaForm.jsx`
- `frontend/src/components/transactions/forms/PurchaseForm.jsx`
- `frontend/src/components/transactions/forms/PaymentForm.jsx`
- `frontend/src/components/PartyFormDialog.js`
- `frontend/src/components/transactions/forms/ExchangeForm.jsx`

---

#### GÃ–REV 1.2: Party Balance API
**Sorun:** Party detay sayfasÄ±nda bakiye ve iÅŸlemler gÃ¶rÃ¼nmÃ¼yor

**Backend Ekle (server.py):**
```python
@api_router.get("/parties/{party_id}/balance")
@api_router.get("/parties/{party_id}/transactions")
```

**Frontend GÃ¼ncelle (PartyDetailPage.js):**
- 3 API Ã§aÄŸrÄ±sÄ±: party, balance, transactions
- UI'da gÃ¶ster: HAS, TL, USD, EUR bakiye + iÅŸlem listesi + sayfalama

---

#### GÃ–REV 1.3: Hurda AltÄ±n ile Ã–deme
**Sorun:** Ã–deme metodunda "Hurda AltÄ±n" var ama detay sorulmuyor

**PaymentForm.jsx GÃ¼ncelle:**
- `payment_method_code === 'GOLD_SCRAP'` ise form aÃ§
- Karat, AÄŸÄ±rlÄ±k, Milyem (editlenebilir) input'larÄ±
- HAS hesaplama gÃ¶ster
- Birden fazla hurda kalemi eklenebilir

---

### ğŸŸ¡ FAZ 2: YÃœKSEK Ã–NCELÄ°KLÄ° (7 GÃ¶rev)

#### GÃ–REV 2.1: KullanÄ±cÄ± YÃ¶netimi
**Yeni Sayfa:** `UsersPage.js`

**Backend:**
- `GET/POST/PUT/DELETE /api/users`
- Roller: ADMIN, STORE_MANAGER, SALES
- Soft delete (is_active: false)

**Frontend:**
- KullanÄ±cÄ± listesi (tablo)
- Create/Edit dialog
- Route guard (yetki kontrolÃ¼)

---

#### GÃ–REV 2.2: Lookup YÃ¶netim Paneli
**Yeni Sayfa:** `SettingsPage.js`

**8 Tab:**
1. Party Types
2. Product Types (+ unit, fixed_weight)
3. Karats
4. Labor Types
5. Stock Statuses
6. Transaction Types
7. Payment Methods (+ commission_rate editlenebilir)
8. Currencies

**Her Lookup Ä°Ã§in:**
- Backend: GET/POST/PUT/DELETE `/api/lookups/{lookup-name}`
- Frontend: Manager component (Liste, Ekle, DÃ¼zenle, Sil)
- Admin yetkisi kontrolÃ¼
- Ä°liÅŸki kontrolÃ¼ (kullanÄ±lÄ±yorsa silinemesin)

---

#### GÃ–REV 2.3: ÃœrÃ¼n - TedarikÃ§i
**Database Ekle:**
```javascript
products: {
  supplier_party_id: "uuid",
  purchase_date: "ISO Date"
}
```

**ProductFormDialog.js:**
- TedarikÃ§i select (sadece party_type_id: 2 veya 3)
- AlÄ±ÅŸ tarihi input

---

#### GÃ–REV 2.4: FotoÄŸraf Upload
**ProductFormDialog.js:**
- File input (capture="environment" - kamera)
- Base64'e Ã§evir
- Preview grid
- Database: `images: []` array'ine ekle

**ProductDetailPage.js:**
- FotoÄŸraf galeri gÃ¶ster

---

#### GÃ–REV 2.5: Barkod Basma
**KÃ¼tÃ¼phane:** `yarn add jsbarcode`

**ProductDetailPage.js:**
- Barkod basma butonu
- Canvas'a barkod Ã§iz
- Print window aÃ§

---

#### GÃ–REV 2.6: Parties - TC ve Adres
**Database Ekle:**
```javascript
parties: {
  tc_number: "11 karakter",     // MÃ¼ÅŸteri iÃ§in
  phone: "10 karakter",
  city: "Metin",                 // Combo deÄŸil!
  district: "Metin",             // Combo deÄŸil!
  address: "Metin"
}
```

**PartyFormDialog.js:**
- MÃ¼ÅŸteri ise: TC input
- Herkes iÃ§in: Telefon, Ä°l (input), Ä°lÃ§e (input), Adres (textarea)
- TedarikÃ§i iÃ§in: Vergi No, Vergi Dairesi

---

#### GÃ–REV 2.7: Sarrafiye (Adet BazlÄ±)
**product_types GÃ¼ncelle:**
```python
{
  "code": "GOLD_QUARTER",
  "unit": "PIECE",        # YENÄ°
  "fixed_weight": 1.8     # YENÄ°
}
```

**ProductFormDialog.js:**
- `unit === 'PIECE'` ise â†’ Adet input + "Sabit aÄŸÄ±rlÄ±k: X gr/adet"
- `unit === 'GRAM'` ise â†’ Gram input

---

### ğŸŸ¢ FAZ 3: TRANSACTION LOGÄ°C (4 GÃ¶rev)

#### GÃ–REV 3.1: AltÄ±n AlÄ±mÄ± - Kar/Zarar
**Backend (financial_v2_transactions.py):**
```python
# Her line iÃ§in:
paid_has = mÃ¼ÅŸteriye_Ã¶denen / has_buy_tl
supplier_sale_has = weight * supplier_fineness
profit_has = supplier_sale_has - paid_has
profit_tl = profit_has * has_sell_tl
```

**PurchaseForm.jsx:**
- Her line'Ä±n altÄ±nda kar/zarar card gÃ¶ster

---

#### GÃ–REV 3.2: SatÄ±ÅŸ - PazarlÄ±k ve KÄ±smi Ã–deme
**SaleForm.jsx:**
```javascript
expected_tl = product.sale_has_value * has_price
actual_paid_tl = kullanÄ±cÄ± giriÅŸi
debt_tl = expected_tl - actual_paid_tl
debt_has = debt_tl / has_price

// Party balance gÃ¼ncelle
```

**UI:**
- Beklenen tutar (disabled)
- MÃ¼ÅŸteri Ã¶deme (input)
- Kalan borÃ§ gÃ¶ster (alert)
- Kar oranÄ± deÄŸiÅŸimi gÃ¶ster

---

#### GÃ–REV 3.3: Tahsilat - Ä°skonto
**ReceiptForm.jsx:**
- Ä°skonto checkbox
- Ä°skonto tutarÄ± (HAS) input
- Kalan borÃ§ hesapla ve gÃ¶ster

---

#### GÃ–REV 3.4: DÃ¶viz - USD/EUR Rate Fix
**safe_init_all_lookups.py:**
```python
snapshot = {
  "usd_buy_tl": 32.15,
  "usd_sell_tl": 32.25,
  "eur_buy_tl": 35.10,
  "eur_sell_tl": 35.22
}
```

**financial_v2_transactions.py:**
```python
from_has = from_amount * from_rate / has_sell_tl
to_has = to_amount * to_rate / has_buy_tl
profit_has = from_has - to_has
```

---

### ğŸŸ¢ FAZ 4: RAPORLAR (1 GÃ¶rev)

#### GÃ–REV 4.1: Raporlar SayfasÄ±
**Yeni Sayfa:** `EnhancedReportsPage.js`

**Backend:**
```python
@api_router.get("/reports/comprehensive")
# Return:
# - Stok durumu (tip bazÄ±nda: gram, adet, HAS)
# - Kasa/Banka/Kredi KartÄ± bakiye
# - Kar/Zarar (HAS ve TL)

@api_router.post("/reports/export")
# Excel export (openpyxl)
```

**Frontend:**
- Tarih aralÄ±ÄŸÄ± seÃ§imi
- Stok raporu tablo
- Bakiye kartlarÄ±
- Kar/Zarar card
- Excel export butonu

---

### ğŸŸ¢ FAZ 5: DÄ°ÄER (1 GÃ¶rev)

#### GÃ–REV 5.1: updated_by AlanÄ±
**TÃ¼m Collection'larda:**
```python
update_data = {
  **request_data,
  "updated_at": datetime.now(timezone.utc),
  "updated_by": user_id  # Token'dan al
}
```

**Eklenmesi Gereken Collection'lar:**
- parties
- products
- financial_transactions
- TÃ¼m lookup collection'larÄ±

---

## ğŸ¯ EMERGENT AI Ä°Ã‡Ä°N TALÄ°MAT

```
Emergent, aÅŸaÄŸÄ±daki dosyayÄ± oku:
- FINAL_ROADMAP_IL_ILCE_YOK.md

Ã–NEMLÄ°:
âœ… WebSocket Ã¼st bar Ã§alÄ±ÅŸÄ±yor (dokunma)
âœ… Hurda milyem = her iÅŸlemde editlenebilir
âœ… Stok giriÅŸi transaction YOK
âœ… Ä°l/Ä°lÃ§e = metin input (combo deÄŸil)

FAZ 1'DEN BAÅLA: Kritik Sorunlar

GÃ–REV 1.1: Combobox Sorunu
1. HurdaForm.jsx'e console log ekle
2. API response kontrol et
3. Value type fix (.toString())
4. Test et

Her adÄ±mda:
- Console log gÃ¶ster
- Test sonucu bildir
- Git commit
- Sonraki gÃ¶reve geÃ§

BaÅŸla!
```

---

## ğŸ“Š Ã–ZET

| Faz | GÃ¶rev SayÄ±sÄ± |
|-----|--------------|
| FAZ 1: Kritik | 3 |
| FAZ 2: YÃ¼ksek Ã–ncelikli | 7 |
| FAZ 3: Transaction | 4 |
| FAZ 4: Raporlar | 1 |
| FAZ 5: DiÄŸer | 1 |
| **TOPLAM** | **16** |

---

## âœ… BAÅARILI TAMAMLANMA KRÄ°TERLERÄ°

### FAZ 1 TamamlandÄ± mÄ±?
- [ ] TÃ¼m combobox'lar dolu
- [ ] Party detayÄ±nda bakiye gÃ¶rÃ¼nÃ¼yor
- [ ] Hurda altÄ±n ile Ã¶deme Ã§alÄ±ÅŸÄ±yor

### FAZ 2 TamamlandÄ± mÄ±?
- [ ] Admin kullanÄ±cÄ± ekleyebiliyor
- [ ] Settings sayfasÄ±nda 8 lookup yÃ¶netilebiliyor
- [ ] ÃœrÃ¼ne tedarikÃ§i atanabiliyor
- [ ] FotoÄŸraf eklenebiliyor
- [ ] Barkod basÄ±labiliyor
- [ ] Party'de TC, telefon, adres (il/ilÃ§e metin) girilebiliyor
- [ ] Sarrafiye Ã¼rÃ¼nleri adet bazlÄ±

### FAZ 3 TamamlandÄ± mÄ±?
- [ ] AltÄ±n alÄ±mÄ±nda kar/zarar gÃ¶rÃ¼nÃ¼yor
- [ ] SatÄ±ÅŸta pazarlÄ±k ve kÄ±smi Ã¶deme yapÄ±labiliyor
- [ ] Tahsilatta iskonto yapÄ±labiliyor
- [ ] DÃ¶viz iÅŸleminde kar/zarar (HAS) hesaplanÄ±yor

### FAZ 4 TamamlandÄ± mÄ±?
- [ ] Raporlar sayfasÄ± var
- [ ] Stok durumu, kasa/banka, kar/zarar gÃ¶rÃ¼nÃ¼yor
- [ ] Excel'e aktarÄ±labiliyor

### FAZ 5 TamamlandÄ± mÄ±?
- [ ] TÃ¼m collection'larda updated_by var

---

**HAZIR! Emergent AI'a verilebilir.** ğŸš€
